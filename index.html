<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Despire</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ----------------- AMBIANCE G√âN√âRALE ----------------- */
body 
{
    margin: 0;
    font-family: "Georgia", serif;
    background-size: cover;
    background-position: center;
    background-attachment: fixed;
    color: #2f3e34;
    overflow-x: hidden;
}

h1,h2,h3 {
    font-weight: normal;
}

/* ----------------- LOGIN ----------------- */
#login {
    position: fixed;
    inset: 0;
    background: rgba(245,245,240,0.98);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 200;
    transition: opacity 3s cubic-bezier(0.4, 0, 0.2, 1); 
}

#login.fade-out {
    opacity: 0;
    pointer-events: none;
}

#loginBox {
    background: rgba(255,255,255,0.85);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

#loginBox input {
    padding: 14px;
    width: 100%;
    border-radius: 12px;
    border: 1px solid #aaa;
    font-size: 16px;
}

#loginBox button {
    margin-top: 20px;
    padding: 14px 30px;
    border: none;
    border-radius: 30px;
    background: #6fa58c;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

/* ----------------- THERMOM√àTRE D'√âNERGIE AM√âLIOR√â ----------------- */
#thermo-container {
    position: absolute;
    left: 20px;
    top: 20px;
    z-index: 100;
    display: none;
    flex-direction: column;
    align-items: center;
    opacity: 0;
    transition: opacity 1.5s ease-in-out;
}

#thermo-container.visible {
    display: flex;
    opacity: 1;
}

#thermo-cadre {
    width: 18px;
    height: 160px;
    background: linear-gradient(to right, 
        rgba(255,255,255,0.4) 0%, 
        rgba(255,255,255,0.6) 50%, 
        rgba(255,255,255,0.4) 100%
    );
    backdrop-filter: blur(8px);
    border: 2px solid rgba(47,62,52,0.3);
    border-radius: 12px 12px 0 0;
    position: relative;
    overflow: hidden;
    box-shadow: 
        inset -2px 0 4px rgba(0,0,0,0.1),
        inset 2px 0 4px rgba(255,255,255,0.3);
    border-bottom: none;
}

#thermo-niveau {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 0%;
    background: linear-gradient(to top,
        #e74c3c 0%,
        #f39c12 50%,
        #2ecc71 100%
    );
    transition: height 3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: visible;
}

.wave {
    position: absolute;
    top: -8px;
    left: -100%;
    width: 300%;
    height: 16px;
    background: radial-gradient(ellipse at center, 
        rgba(255,255,255,0.4) 0%, 
        transparent 70%
    );
    border-radius: 50%;
    animation: wave-motion 3s ease-in-out infinite;
}

@keyframes wave-motion {
    0%, 100% {
        transform: translateX(0) translateY(0);
    }
    25% {
        transform: translateX(10%) translateY(-2px);
    }
    50% {
        transform: translateX(0) translateY(0);
    }
    75% {
        transform: translateX(-10%) translateY(-2px);
    }
}

.bubble {
    position: absolute;
    background: rgba(255,255,255,0.6);
    border-radius: 50%;
    animation: bubble-rise linear infinite;
    box-shadow: inset -1px -1px 2px rgba(0,0,0,0.1);
}

.bubble:nth-child(2) {
    width: 3px;
    height: 3px;
    left: 25%;
    animation-duration: 4s;
    animation-delay: 0s;
}

.bubble:nth-child(3) {
    width: 4px;
    height: 4px;
    left: 60%;
    animation-duration: 5s;
    animation-delay: 1.2s;
}

.bubble:nth-child(4) {
    width: 2px;
    height: 2px;
    left: 45%;
    animation-duration: 3.5s;
    animation-delay: 2s;
}

@keyframes bubble-rise {
    0% {
        bottom: 0;
        opacity: 0;
        transform: scale(0.8);
    }
    10% {
        opacity: 1;
    }
    80% {
        opacity: 0.8;
    }
    100% {
        bottom: 100%;
        opacity: 0;
        transform: scale(1.2);
    }
}

#thermo-reservoir {
    width: 32px;
    height: 32px;
    background: linear-gradient(135deg, 
        #e74c3c 0%, 
        #c0392b 100%
    );
    border: 2px solid rgba(47,62,52,0.3);
    border-radius: 50%;
    margin-top: -3px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 
        inset -3px -3px 6px rgba(0,0,0,0.2),
        inset 3px 3px 6px rgba(255,100,100,0.3),
        0 2px 8px rgba(231,76,60,0.3);
}

#thermo-reservoir::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    width: 10px;
    height: 10px;
    background: radial-gradient(circle, 
        rgba(255,255,255,0.6) 0%, 
        transparent 70%
    );
    border-radius: 50%;
}

#thermo-label {
    font-family: "Georgia", serif;
    font-size: 11px;
    font-weight: bold;
    margin-top: 6px;
    color: #2f3e34;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

#main {
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 20px;
    min-height: 100vh;
    box-sizing: border-box;
    animation: fadeIn 1.2s ease-out;
    position: relative;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeInTitle {
    from { 
        opacity: 0; 
        transform: translateY(-20px);
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

@keyframes fadeInVaporeux {
    0% { 
        opacity: 0;
        filter: blur(15px);
        transform: scale(0.98);
    }
    100% { 
        opacity: 1;
        filter: blur(0);
        transform: scale(1);
    }
}

#main h2 {
    font-size: 1.1rem; 
    line-height: 1.5;
    text-align: center;
    margin: 10px auto 20px auto;
    padding: 20px 20px 20px 70px;
    width: 90%;
    max-width: 600px;
    background: rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border: 1px solid rgba(255, 255, 255, 0.4);
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
    color: #2f3e34;
    opacity: 0;
    animation: fadeInTitle 3.5s ease-out 1.5s forwards;
}

#garden {
    position: relative;
    width: 100%;
    max-width: 900px;
    height: 65vh;
    min-height: 400px;
    border-radius: 30px;
    background: rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(5px);
    overflow: hidden;
    box-shadow: inset 0 0 40px rgba(0,0,0,0.05);
    opacity: 0;
    filter: blur(15px);
    animation: fadeInVaporeux 4s ease-out 1s forwards;
}

#addBtn {
    display: block;
    margin: 20px auto;
    padding: 14px 30px;
    border-radius: 40px;
    border: none;
    background: #6fa58c;
    color: white;
    font-size: 16px;
    cursor: pointer;
    transition: transform 0.2s;
    opacity: 0;
    animation: fadeIn 2s ease-in-out 1.5s forwards;
}

#addBtn:hover {
    transform: scale(1.05);
}

#quote {
    text-align: center;
    font-style: italic;
    opacity: 0.8;
    margin-bottom: 30px;
}

#thankYouMsg {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0);
    background: rgba(139,191,159,0.95);
    color: white;
    padding: 30px 50px;
    border-radius: 20px;
    font-size: 20px;
    text-align: center;
    z-index: 150;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    max-width: 80%;
}

#thankYouMsg.show {
    transform: translate(-50%, -50%) scale(1);
}

.plant-container {
    position: absolute;
}

.plant {
    animation: breathe 10s ease-in-out infinite;
    cursor: pointer;
    transition: transform 0.5s ease, filter 0.3s ease;
    position: relative;
}

.plant.arbre, .plant.arbuste {
    transform-origin: bottom center;
}

.plant.fleur, .plant.fruit {
    transform-origin: center center;
}

.plant.oiseau, .plant.papillon {
    transform-origin: center center;
}

.plant:hover {
    filter: brightness(1.1) drop-shadow(0 0 15px rgba(139,191,159,0.6));
}

.highlight-circle {
    position: absolute;
    border: 4px solid #ffd782;
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
    pointer-events: none;
    box-shadow: 0 0 20px rgba(255,215,130,0.8);
}

@keyframes pulse {
    0%, 100% { 
        transform: scale(1);
        opacity: 1;
    }
    50% { 
        transform: scale(1.15);
        opacity: 0.7;
    }
}

@keyframes breathe {
    0%,100% { transform: scale(var(--scale, 1)); }
    50% { transform: scale(calc(var(--scale, 1) * 1.1)); }
}

#overlay {
    position: fixed;
    inset: 0;
    background: rgba(250,250,245,0.96);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 90;
}

form {
    background: white;
    padding: 40px;
    border-radius: 25px;
    width: 90%;
    max-width: 600px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    max-height: 90vh;
    overflow-y: auto;
}

form select, form textarea, form input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 12px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}

form button {
    margin-top: 20px;
    padding: 14px;
    width: 100%;
    border-radius: 30px;
    border: none;
    background: #6fa58c;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

form button:hover {
    background: #5d8c73;
}

.preview-section {
    background: rgba(111,165,140,0.1);
    padding: 20px;
    border-radius: 15px;
    margin: 15px 0;
    border-left: 4px solid #6fa58c;
}

.preview-section h4 {
    color: #6fa58c;
    margin-top: 0;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.preview-section p {
    margin: 8px 0;
    line-height: 1.6;
    font-size: 14px;
}

.preview-section ul {
    margin: 8px 0;
    padding-left: 20px;
}

.preview-section li {
    margin: 5px 0;
    line-height: 1.5;
}

#categoryPreview {
    display: none;
}

#itemsForm {
    display: none;
}

.form-step {
    animation: fadeIn 0.5s ease-out;
}

.info-box {
    background: rgba(255,215,130,0.2);
    padding: 12px;
    border-radius: 10px;
    font-size: 13px;
    margin: 10px 0;
    color: #6b5d4f;
}

.forces-grid {
    display: grid;
    gap: 10px;
}

.force-option, .value-option {
    padding: 10px;
    background: rgba(255,255,255,0.8);
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
}

.force-option:hover, .value-option:hover {
    border-color: #6fa58c;
    background: rgba(111,165,140,0.1);
}

.force-option.selected, .value-option.selected {
    border-color: #6fa58c;
    background: rgba(111,165,140,0.2);
}

#notebook {
    position: fixed;
    right: -100%;
    top: 0;
    bottom: 0;
    width: 100%;
    max-width: 550px;
    background: linear-gradient(to right, #8b7355 0%, #8b7355 20px, #f9f7f1 20px);
    box-shadow: -10px 0 30px rgba(0,0,0,0.3);
    z-index: 150;
    transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}

#notebook.open {
    right: 0;
}

#notebook::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 40px;
    bottom: 40px;
    width: 12px;
    background: repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 15px,
        #6b5d4f 15px,
        #6b5d4f 20px,
        transparent 20px,
        transparent 35px
    );
    border-radius: 2px;
}

#notebookContent {
    margin-left: 30px;
    padding: 40px 30px 100px 20px;
    height: 100%;
    overflow-y: auto;
    background: 
        repeating-linear-gradient(
            transparent,
            transparent 31px,
            #e8dcc8 31px,
            #e8dcc8 32px
        ),
        #f9f7f1;
    box-sizing: border-box;
}

#closeNotebook {
    position: absolute;
    right: 20px;
    top: 20px;
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #6fa58c;
    z-index: 1;
    transition: transform 0.2s;
}

#closeNotebook:hover {
    transform: rotate(90deg);
}

.notebook-page {
    margin-bottom: 60px;
    padding-bottom: 30px;
    border-bottom: 2px dashed #d4c5b0;
    line-height: 32px;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 3px solid #6fa58c;
}

.page-date {
    font-size: 14px;
    color: #8b7355;
    font-style: italic;
}

.page-number {
    background: #6fa58c;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
}

.notebook-section {
    margin: 20px 0;
}

.section-label {
    font-weight: bold;
    color: #6fa58c;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.section-content {
    color: #2f3e34;
    font-size: 15px;
    padding-left: 10px;
}

.interaction-stats {
    display: flex;
    gap: 15px;
    margin-top: 15px;
    padding: 10px;
    background: rgba(139,191,159,0.1);
    border-radius: 8px;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
}

.water-actions {
    display: flex;
    gap: 15px;
    margin-top: 20px;
    padding: 15px;
    background: rgba(139,191,159,0.15);
    border-radius: 12px;
    justify-content: center;
}

.water-btn {
    background: white;
    border: 2px solid #6fa58c;
    padding: 12px 20px;
    border-radius: 30px;
    cursor: pointer;
    font-size: 32px;
    transition: all 0.3s;
}

.water-btn:hover:not(:disabled) {
    background: #6fa58c;
    transform: scale(1.1);
}

.water-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
    border-color: #ccc;
}

.water-btn.used {
    background: #d0e8d0;
    border-color: #8bbf9f;
}

#pageNav {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    background: rgba(255,255,255,0.9);
    padding: 10px 20px;
    border-radius: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

#pageNav button {
    background: #6fa58c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
}

#pageNav button:disabled {
    background: #ccc;
    cursor: not-allowed;
}

#pageInfo {
    display: flex;
    align-items: center;
    padding: 0 10px;
    color: #6fa58c;
    font-weight: bold;
}

.loading {
    text-align: center;
    padding: 20px;
    color: #6fa58c;
}

@media (max-width: 600px) {
    #main {
        padding: 15px;
    }

    #garden {
        height: 70vh;
        min-height: 400px;
    }

    #main h2 {
        font-size: 0.95rem;
        padding: 18px 18px 18px 65px;
    }

    #addBtn {
        padding: 12px 24px;
        font-size: 16px;
    }

    #thermo-container {
        left: 12px;
        top: 18px;
        transform: scale(0.9);
    }

    form {
        width: 95%;
        padding: 30px 20px;
    }
}

@media (max-height: 500px) {
    #garden {
        height: 300px;
    }
}
</style>

</head>

<body>

<div id="login">
    <div id="loginBox">
        <h2>üå± Le Facteur Humain</h2>
        <p>Rejoins le bivouac des pirates</p>
        <input id="pwd" type="password" placeholder="mot de passe">
        <button id="loginBtn">Entrer</button>
    </div>
</div>

<div id="main">
    <div id="thermo-container">
        <div id="thermo-cadre">
            <div id="thermo-niveau">
                <div class="wave"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
                <div class="bubble"></div>
            </div>
        </div>
        <div id="thermo-reservoir"></div>
        <div id="thermo-label">√ânergie</div>
    </div>

```
<h2>
    Si nou s√®m brinzell nou sa pa k√©yir babafig / <br>
    si nou plant' banann' nou sa pa manz' kaviar ! <br> 
    Al√© tir in feuye / r√©colt leu tempo !
</h2>

<div id="quote"></div>

<button id="addBtn">‚ûï Planter une exp√©rience</button>

<div id="garden">
    <div class="loading">üå± Chargement de la zar l'or...</div>
</div>
```

</div>

<div id="thankYouMsg"></div>

<div id="overlay">
    <form id="form">
        <div id="categorySelection" class="form-step">
            <h3>üåø Planter une exp√©rience</h3>

```
        <label style="font-weight: bold; margin-top: 15px; display: block;">Choisir une cat√©gorie :</label>
        <select id="categorySelect">
            <option value="">-- S√©lectionner --</option>
            <option value="aide">ü§ù Aide & soutien</option>
            <option value="apprentissage">üß† Apprentissage</option>
            <option value="amelioration">üîß Am√©lioration concr√®te</option>
            <option value="effort">üéØ Effort invisible</option>
            <option value="initiative">üå± Initiative</option>
            <option value="collectif">üë• R√©ussite collective</option>
            <option value="sens">üß≠ Sens & valeurs</option>
        </select>
    </div>

    <div id="categoryPreview" class="form-step">
        <div id="previewContent"></div>
        <button type="button" id="validateBtn">‚úì Cela me convient, continuer</button>
        <button type="button" id="backBtn1" style="background: #999; margin-top: 10px;">‚Üê Retour aux cat√©gories</button>
    </div>

    <div id="itemsForm" class="form-step">
        <h3 id="itemsFormTitle"></h3>
        <div id="itemsFormContent"></div>
        
        <div class="info-box">
            üìå <strong>Forces & valeurs :</strong> optionnelles, pas obligatoires. Vous pouvez en choisir jusqu'√† 3 de chaque.
        </div>

        <label style="font-weight: bold; margin-top: 20px; display: block;">Forces mobilis√©es (max 3) :</label>
        <div id="forcesContainer" class="forces-grid"></div>

        <label style="font-weight: bold; margin-top: 20px; display: block;">Valeurs en jeu (max 3) :</label>
        <div id="valeursContainer" class="forces-grid"></div>

        <button type="submit">üå∏ Planter</button>
        <button type="button" id="backBtn2" style="background: #999; margin-top: 10px;">‚Üê Changer de cat√©gorie</button>
    </div>
</form>
```

</div>

<div id="notebook">
    <button id="closeNotebook">‚úï</button>
    <div id="notebookContent"></div>
    <div id="pageNav">
        <button id="prevBtn">‚Üê Pr√©c√©dent</button>
        <div id="pageInfo"></div>
        <button id="nextBtn">Suivant ‚Üí</button>
    </div>
</div>

<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getDatabase, ref, push, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

  const firebaseConfig = {
    apiKey: "AIzaSyADBlPY8lK_52mFTWWHdoEBcPXa4Dk3FVA",
    authDomain: "jardin-3f127.firebaseapp.com",
    databaseURL: "https://jardin-3f127-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "jardin-3f127",
    storageBucket: "jardin-3f127.firebasestorage.app",
    messagingSenderId: "371927426307",
    appId: "1:371927426307:web:dba165b1aaf4b8179e3536"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const plantsRef = ref(database, 'plants');

  const PASSWORD = "jardin";
  const NIVEAU_ENERGIE = 75;

  const quotes = [
      "Ce √† quoi tu pr√™tes attention grandit.",
      "Chaque geste nourrit une racine invisible.",
      "Le vivant se cultive par la pr√©sence.",
      "Un jardin est une m√©moire qui respire."
  ];

  const thankYouMessages = [
      "üå± Une nouvelle graine prend racine dans notre jardin collectif !",
      "‚ú® Merci pour cette belle contribution, elle fera grandir notre √©cosyst√®me !",
      "üå∏ Quelle fiert√© de voir le jardin s'√©panouir gr√¢ce √† toi !",
      "üåø Ta plantation enrichit la biodiversit√© de notre espace partag√© !",
      "üå≥ Chaque exp√©rience plant√©e nourrit la for√™t de nos apprentissages !",
      "üíö Gratitude pour ce don √† la terre commune, il portera ses fruits !",
      "üåæ Ta contribution s'enracine et inspirera d'autres jardiniers !",
      "ü™¥ Merci de cultiver avec nous cet espace de croissance mutuelle !",
      "üå∫ Belle plantation ! Le jardin te remercie de ta pr√©sence attentive !",
      "üçÉ Chaque plante ajout√©e tisse un peu plus notre √©cosyst√®me vivant !"
  ];

  const plantTypes = {
    arbre: ["assets/plants/arbre1.png", "assets/plants/arbre2.png", "assets/plants/arbre3.png"],
    arbuste: ["assets/plants/arbuste1.png", "assets/plants/arbuste2.png", "assets/plants/arbuste3.png"],
    fleur: ["assets/plants/fleur1.png", "assets/plants/fleur2.png", "assets/plants/fleur3.png", "assets/plants/fleur4.png"],
    fruit: ["assets/plants/fruit1.png", "assets/plants/fruit2.png", "assets/plants/fruit3.png"],
    oiseau: ["assets/plants/oiseau1.png", "assets/plants/oiseau2.png", "assets/plants/oiseau3.png"],
    papillon: ["assets/plants/papillon1.png", "assets/plants/papillon2.png", "assets/plants/papillon3.png"]
  };

  const backgrounds = ["assets/bg-paper.jpg", "assets/bg1.jpg", "assets/bg2.jpg", "assets/bg3.jpg", "assets/bg4.jpg"];

  const categories = {
    aide: {
      emoji: "ü§ù", nom: "Aide & soutien",
      question: "Qu'est-ce qui a facilit√© le travail ou le v√©cu de quelqu'un ?",
      exemple: "¬´ Cette semaine, Paul a pris 20 minutes pour m'expliquer une proc√©dure que je ne comprenais pas. J'ai pu avancer sans stress et √©viter une erreur. ¬ª",
      mecanismes: ["Reconnaissance du prosocial", "Renforcement du sentiment d'appartenance", "Diminution du stress per√ßu"],
      sources: ["<strong>Adam Grant ‚Äì Give and Take</strong><br>‚Üí Voir l'impact concret de son aide augmente la motivation et l'engagement.", "<strong>Baumeister & Leary</strong><br>‚Üí Le besoin d'appartenance est un besoin psychologique fondamental.", "<strong>Thompson & Bolino (2018)</strong><br>‚Üí La reconnaissance de l'aide renforce la coop√©ration future."],
      impact: "plus d'entraide spontan√©e, moins d'isolement.",
      items: [
        { label: "Qu'a fait la personne ?", placeholder: "Fait concret, observable", type: "textarea", name: "item1", required: true },
        { label: "En quoi cela a aid√© ?", placeholder: "Impact imm√©diat", type: "textarea", name: "item2", required: true },
        { label: "(optionnel) Pour qui cela a compt√© ?", placeholder: "Personne ou groupe concern√©", type: "input", name: "item3", required: false }
      ]
    },
    apprentissage: {
      emoji: "üß†", nom: "Apprentissage",
      question: "Qu'avons-nous compris de mieux ?",
      exemple: "¬´ J'ai compris que lorsque je pr√©pare mes r√©ponses √† l'avance, l'√©change devient rigide. En laissant plus de place √† l'√©coute, la discussion est plus fluide. ¬ª",
      mecanismes: ["Transformation de l'erreur en ressource", "D√©veloppement du sentiment de comp√©tence", "Mentalit√© de croissance"],
      sources: ["<strong>Carol Dweck ‚Äì Growth Mindset</strong><br>‚Üí Apprendre = moteur de motivation durable.", "<strong>Kolb ‚Äì Apprentissage exp√©rientiel</strong><br>‚Üí Le sens √©merge de l'exp√©rience r√©fl√©chie.", "<strong>Edmondson</strong><br>‚Üí Les √©quipes apprenantes performent mieux √† long terme."],
      impact: "moins de peur de se tromper, plus d'adaptation.",
      items: [
        { label: "Situation / exp√©rience", placeholder: "D√©cris le contexte...", type: "textarea", name: "item1", required: true },
        { label: "Ce que j'ai compris ou appris", placeholder: "Ta d√©couverte...", type: "textarea", name: "item2", required: true },
        { label: "Ce que je ferai diff√©remment", placeholder: "Action future...", type: "textarea", name: "item3", required: true }
      ]
    },
    amelioration: {
      emoji: "üîß", nom: "Am√©lioration concr√®te",
      question: "Qu'est-ce qui fonctionne mieux qu'avant ?",
      exemple: "¬´ Avant, on passait 15 minutes √† chercher l'info. Maintenant, elle est centralis√©e, on gagne du temps chaque jour. ¬ª",
      mecanismes: ["Sentiment d'efficacit√© collective", "Perception de progr√®s (m√™me petit)"],
      sources: ["<strong>Teresa Amabile ‚Äì Progress Principle</strong><br>‚Üí Le sentiment de progr√®s est le plus puissant moteur de motivation au travail.", "<strong>Lean / Kaizen</strong><br>‚Üí Les petites am√©liorations r√©p√©t√©es ont un impact cumulatif majeur."],
      impact: "redonne prise sur le r√©el, combat l'impuissance.",
      items: [
        { label: "Avant / apr√®s", placeholder: "Tr√®s court, l'essentiel...", type: "textarea", name: "item1", required: true },
        { label: "Ce qui a chang√©", placeholder: "La modification apport√©e...", type: "textarea", name: "item2", required: true },
        { label: "B√©n√©fice principal", placeholder: "Impact positif...", type: "textarea", name: "item3", required: true }
      ]
    },
    effort: {
      emoji: "üéØ", nom: "Effort invisible",
      question: "Qu'est-ce qui a √©t√© tenu malgr√© la difficult√© ?",
      exemple: "¬´ Malgr√© une semaine √©motionnellement lourde, j'ai maintenu la qualit√© de l'accueil des usagers. ¬ª",
      mecanismes: ["Reconnaissance de la charge invisible", "Justice symbolique", "Pr√©vention de l'√©puisement"],
      sources: ["<strong>Axel Honneth ‚Äì Th√©orie de la reconnaissance</strong><br>‚Üí Le manque de reconnaissance est une source majeure de souffrance au travail.", "<strong>Siegrist ‚Äì Effort / R√©compense</strong><br>‚Üí Le d√©s√©quilibre effort-reconnaissance g√©n√®re stress et burnout."],
      impact: "r√©paration morale, baisse du ressentiment.",
      items: [
        { label: "Ce qui √©tait difficile", placeholder: "La difficult√© rencontr√©e...", type: "textarea", name: "item1", required: true },
        { label: "Ce qui a √©t√© maintenu / assur√©", placeholder: "Malgr√© tout, tu as tenu...", type: "textarea", name: "item2", required: true },
        { label: "Pourquoi c'√©tait important", placeholder: "Le sens de cet effort...", type: "textarea", name: "item3", required: true }
      ]
    },
    initiative: {
      emoji: "üå±", nom: "Initiative",
      question: "Qu'est-ce qui a √©t√© tent√© ?",
      exemple: "¬´ J'ai propos√© un nouvel outil, m√™me si tout n'est pas encore en place, √ßa a ouvert la discussion. ¬ª",
      mecanismes: ["Autonomie", "Droit √† l'essai", "Innovation psychologiquement s√ªre"],
      sources: ["<strong>Deci & Ryan ‚Äì Autod√©termination</strong><br>‚Üí L'autonomie est un pilier de la motivation intrins√®que.", "<strong>Edmondson</strong><br>‚Üí Sans droit √† l'initiative, pas d'innovation durable."],
      impact: "plus d'id√©es, moins de conformisme passif.",
      items: [
        { label: "L'id√©e ou l'initiative", placeholder: "Ce que tu as propos√©/tent√©...", type: "textarea", name: "item1", required: true },
        { label: "Pourquoi elle a √©t√© lanc√©e", placeholder: "La motivation...", type: "textarea", name: "item2", required: true },
        { label: "Ce que cela a permis (m√™me partiellement)", placeholder: "R√©sultat, m√™me partiel...", type: "textarea", name: "item3", required: true }
      ]
    },
    collectif: {
      emoji: "üë•", nom: "R√©ussite collective",
      question: "Quand avons-nous mieux fonctionn√© ensemble ?",
      exemple: "¬´ Lors de ce projet, les informations ont bien circul√© et les d√©cisions ont √©t√© prises ensemble. ¬ª",
      mecanismes: ["Identit√© collective", "Coh√©sion", "Intelligence collective"],
      sources: ["<strong>Weick ‚Äì Sensemaking</strong><br>‚Üí Le sens est co-construit dans l'action collective.", "<strong>Hackman</strong><br>‚Üí Les √©quipes efficaces se d√©finissent par leurs processus, pas seulement leurs r√©sultats."],
      impact: "moins de silos, plus de coop√©ration.",
      items: [
        { label: "Moment / contexte", placeholder: "Quand ? Dans quel cadre ?", type: "textarea", name: "item1", required: true },
        { label: "Ce qui a bien circul√©", placeholder: "Info, d√©cision, entraide...", type: "textarea", name: "item2", required: true },
        { label: "Effet sur le travail ou le climat", placeholder: "Impact ressenti...", type: "textarea", name: "item3", required: true }
      ]
    },
    sens: {
      emoji: "üß≠", nom: "Sens & valeurs",
      question: "Quand avons-nous agi de fa√ßon align√©e ?",
      exemple: "¬´ Nous avons pris plus de temps pour respecter la situation de la personne, m√™me si c'√©tait plus lent. ¬ª",
      mecanismes: ["Alignement valeurs‚Äìactions", "Motivation morale", "Pr√©vention du cynisme"],
      sources: ["<strong>Viktor Frankl</strong><br>‚Üí Le sens prot√®ge face √† l'adversit√©.", "<strong>Rosso, Dekas & Wrzesniewski (2010)</strong><br>‚Üí Le sens au travail augmente engagement et r√©silience."],
      impact: "r√©sistance √† l'usure et √† la perte de sens.",
      items: [
        { label: "Situation", placeholder: "Le contexte...", type: "textarea", name: "item1", required: true },
        { label: "Valeur ou principe respect√©", placeholder: "Ce qui a √©t√© honor√©...", type: "textarea", name: "item2", required: true },
        { label: "Pourquoi c'√©tait important", placeholder: "Le sens profond...", type: "textarea", name: "item3", required: true }
      ]
    }
  };

  const forcesVIA = [
    { group: "üß† SAGESSE ET CONNAISSANCE", items: ["Curiosit√©", "Amour de l'apprentissage", "Jugement / Pens√©e critique", "Ing√©niosit√© / Cr√©ativit√©", "Perspective / Sagesse"] },
    { group: "üí™ COURAGE", items: ["Bravoure", "Pers√©v√©rance", "Int√©grit√© / Honn√™tet√©", "Enthousiasme"] },
    { group: "‚ù§Ô∏è HUMANIT√â", items: ["Amour", "Gentillesse", "Intelligence sociale / Empathie"] },
    { group: "‚öñÔ∏è JUSTICE", items: ["√âquit√©", "Leadership", "Travail d'√©quipe / Esprit de citoyennet√©"] },
    { group: "üßò TEMP√âRANCE", items: ["Pardon / Indulgence", "Humilit√© / Modestie", "Prudence / Pr√©venance", "Autocontr√¥le / R√©gulation de soi"] },
    { group: "‚ú® TRANSCENDANCE", items: ["Appr√©ciation de la beaut√© et de l'excellence", "Gratitude", "Espoir / Optimisme", "Humour", "Spiritualit√© / Foi"] }
  ];

  const valeursSchwartz = [
    { group: "üåç OUVERTURE AU CHANGEMENT", items: ["Autod√©termination-pens√©e", "Autod√©termination-action", "Stimulation", "H√©donisme"] },
    { group: "üéØ CROISSANCE PERSONNELLE", items: ["R√©alisation", "Pouvoir-dominance", "Pouvoir-ressources"] },
    { group: "üõ°Ô∏è CONSERVATION", items: ["Image publique", "S√©curit√©-personnel", "Tradition", "Conformit√©-r√®gles", "Conformit√©-interpersonnelle", "Humilit√©"] },
    { group: "üíó D√âPASSEMENT DE SOI", items: ["Bienveillance-soins", "Bienveillance-fiabilit√©", "Universalisme-pr√©occupation", "Universalisme-nature", "Universalisme-tol√©rance"] }
  ];

  let data = [];
  let currentPage = 0;
  let sessionWatered = {};
  let selectedCategory = null;
  let selectedForces = [];
  let selectedValeurs = [];

  const overlay = document.getElementById('overlay');
  const form = document.getElementById('form');
  const garden = document.getElementById('garden');
  const notebook = document.getElementById('notebook');
  const notebookContent = document.getElementById('notebookContent');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const pageInfo = document.getElementById('pageInfo');

  function setRandomBackground() {
    const randomBg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
    document.body.style.backgroundImage = 'url("' + randomBg + '")';
  }

  function showThankYouMessage() {
    const msg = thankYouMessages[Math.floor(Math.random() * thankYouMessages.length)];
    const msgEl = document.getElementById('thankYouMsg');
    msgEl.textContent = msg;
    msgEl.classList.add('show');
    setTimeout(function() { msgEl.classList.remove('show'); }, 4000);
  }

  function checkPassword() {
    const pwd = document.getElementById('pwd');
    const login = document.getElementById('login');
    const main = document.getElementById('main');
    const thermo = document.getElementById('thermo-container');
    const niveau = document.getElementById('thermo-niveau');
    const quote = document.getElementById('quote');

    if (pwd.value === PASSWORD) {
        setRandomBackground();
        loadPlants();
        quote.innerText = quotes[Math.floor(Math.random()*quotes.length)];
        main.style.display = "flex";
        setTimeout(function() { thermo.classList.add('visible'); }, 500);
        setTimeout(function() { niveau.style.height = NIVEAU_ENERGIE + "%"; }, 1500);
        login.classList.add('fade-out');
        setTimeout(function() { login.style.display = "none"; }, 3000);
    } else {
        alert("Mot de passe incorrect");
    }
  }

  document.getElementById('loginBtn').addEventListener('click', checkPassword);
  document.getElementById('pwd').addEventListener('keypress', function(e) {
    if (e.key === 'Enter') checkPassword();
  });

  document.getElementById('addBtn').addEventListener('click', function() {
      document.getElementById('categorySelection').style.display = 'block';
      document.getElementById('categoryPreview').style.display = 'none';
      document.getElementById('itemsForm').style.display = 'none';
      document.getElementById('categorySelect').value = '';
      selectedCategory = null;
      selectedForces = [];
      selectedValeurs = [];
      overlay.style.display = "flex";
  });

  document.getElementById('categorySelect').addEventListener('change', function() {
    const categoryKey = this.value;
    if (!categoryKey) {
        document.getElementById('categoryPreview').style.display = 'none';
        return;
    }
    selectedCategory = categoryKey;
    const cat = categories[categoryKey];
    const previewHTML = '<h3>' + cat.emoji + ' ' + cat.nom + '</h3>' +
      '<div class="preview-section"><h4>üéØ Question centrale</h4><p>' + cat.question + '</p></div>' +
      '<div class="preview-section"><h4>üé¨ Exemple</h4><p>' + cat.exemple + '</p></div>' +
      '<div class="preview-section"><h4>üß† M√©canismes activ√©s</h4><ul>' + cat.mecanismes.map(function(m) { return '<li>' + m + '</li>'; }).join('') + '</ul></div>' +
      '<div class="preview-section"><h4>üî¨ Sources & id√©es fortes</h4><ul>' + cat.sources.map(function(s) { return '<li>' + s + '</li>'; }).join('') + '</ul></div>' +
      '<div class="preview-section"><h4>üëâ Impact cl√©</h4><p>' + cat.impact + '</p></div>';
    document.getElementById('previewContent').innerHTML = previewHTML;
    document.getElementById('categorySelection').style.display = 'none';
    document.getElementById('categoryPreview').style.display = 'block';
  });

  document.getElementById('validateBtn').addEventListener('click', function() {
    if (!selectedCategory) return;
    const cat = categories[selectedCategory];
    document.getElementById('itemsFormTitle').textContent = cat.emoji + ' ' + cat.nom;
    let itemsHTML = '';
    cat.items.forEach(function(item) {
      if (item.type === 'textarea') {
        itemsHTML += '<label style="font-weight: bold; margin-top: 15px; display: block;">' + item.label + (item.required ? ' *' : '') + '</label>' +
          '<textarea name="' + item.name + '" placeholder="' + item.placeholder + '" ' + (item.required ? 'required' : '') + '></textarea>';

```
  } else {
    itemsHTML += '<label style="font-weight: bold; margin-top: 15px; display: block;">' + item.label + (item.required ? ' *' : '') + '</label>' +
      '<input name="' + item.name + '" placeholder="' + item.placeholder + '" ' + (item.required ? 'required' : '') + '>';
  }
});
document.getElementById('itemsFormContent').innerHTML = itemsHTML;
createForcesSelector();
createValeursSelector();
document.getElementById('categoryPreview').style.display = 'none';
document.getElementById('itemsForm').style.display = 'block';
```

});

document.getElementById(‚ÄòbackBtn1‚Äô).addEventListener(‚Äòclick‚Äô, backToCategories);
document.getElementById(‚ÄòbackBtn2‚Äô).addEventListener(‚Äòclick‚Äô, backToCategories);

function backToCategories() {
document.getElementById(‚ÄòcategorySelection‚Äô).style.display = ‚Äòblock‚Äô;
document.getElementById(‚ÄòcategoryPreview‚Äô).style.display = ‚Äònone‚Äô;
document.getElementById(‚ÄòitemsForm‚Äô).style.display = ‚Äònone‚Äô;
selectedCategory = null;
selectedForces = [];
selectedValeurs = [];
}

function createForcesSelector() {
const container = document.getElementById(‚ÄòforcesContainer‚Äô);
container.innerHTML = ‚Äò‚Äô;
forcesVIA.forEach(function(group) {
const groupDiv = document.createElement(‚Äòdiv‚Äô);
groupDiv.style.marginTop = ‚Äò15px‚Äô;
const groupLabel = document.createElement(‚Äòdiv‚Äô);
groupLabel.textContent = group.group;
groupLabel.style.fontWeight = ‚Äòbold‚Äô;
groupLabel.style.fontSize = ‚Äò13px‚Äô;
groupLabel.style.marginBottom = ‚Äò8px‚Äô;
groupLabel.style.color = ‚Äò#6fa58c‚Äô;
groupDiv.appendChild(groupLabel);
group.items.forEach(function(force) {
const div = document.createElement(‚Äòdiv‚Äô);
div.className = ‚Äòforce-option‚Äô;
div.textContent = force;
div.onclick = function() { toggleForce(force, div); };
groupDiv.appendChild(div);
});
container.appendChild(groupDiv);
});
}

function createValeursSelector() {
const container = document.getElementById(‚ÄòvaleursContainer‚Äô);
container.innerHTML = ‚Äò‚Äô;
valeursSchwartz.forEach(function(group) {
const groupDiv = document.createElement(‚Äòdiv‚Äô);
groupDiv.style.marginTop = ‚Äò15px‚Äô;
const groupLabel = document.createElement(‚Äòdiv‚Äô);
groupLabel.textContent = group.group;
groupLabel.style.fontWeight = ‚Äòbold‚Äô;
groupLabel.style.fontSize = ‚Äò13px‚Äô;
groupLabel.style.marginBottom = ‚Äò8px‚Äô;
groupLabel.style.color = ‚Äò#6fa58c‚Äô;
groupDiv.appendChild(groupLabel);
group.items.forEach(function(valeur) {
const div = document.createElement(‚Äòdiv‚Äô);
div.className = ‚Äòvalue-option‚Äô;
div.textContent = valeur;
div.onclick = function() { toggleValeur(valeur, div); };
groupDiv.appendChild(div);
});
container.appendChild(groupDiv);
});
}

function toggleForce(force, element) {
const index = selectedForces.indexOf(force);
if (index > -1) {
selectedForces.splice(index, 1);
element.classList.remove(‚Äòselected‚Äô);
} else {
if (selectedForces.length < 3) {
selectedForces.push(force);
element.classList.add(‚Äòselected‚Äô);
} else {
alert(‚ÄòVous pouvez s√©lectionner maximum 3 forces‚Äô);
}
}
}

function toggleValeur(valeur, element) {
const index = selectedValeurs.indexOf(valeur);
if (index > -1) {
selectedValeurs.splice(index, 1);
element.classList.remove(‚Äòselected‚Äô);
} else {
if (selectedValeurs.length < 3) {
selectedValeurs.push(valeur);
element.classList.add(‚Äòselected‚Äô);
} else {
alert(‚ÄòVous pouvez s√©lectionner maximum 3 valeurs‚Äô);
}
}
}

function loadPlants() {
onValue(plantsRef, function(snapshot) {
data = [];
snapshot.forEach(function(childSnapshot) {
const plant = childSnapshot.val();
plant.firebaseId = childSnapshot.key;
data.push(plant);
});
data.sort(function(a, b) { return b.id - a.id; });
renderGarden();
});
}

function getRandomPlantType() {
const types = [‚Äòarbre‚Äô, ‚Äòarbuste‚Äô, ‚Äòfleur‚Äô, ‚Äòfruit‚Äô, ‚Äòoiseau‚Äô, ‚Äòpapillon‚Äô];
return types[Math.floor(Math.random() * types.length)];
}

function getPositionForType(type) {
let x, y;
switch(type) {
case ‚Äòarbre‚Äô:
case ‚Äòarbuste‚Äô:
x = Math.random() * 85;
y = 60 + Math.random() * 35;
break;
case ‚Äòfleur‚Äô:
case ‚Äòfruit‚Äô:
x = Math.random() * 85;
y = 35 + Math.random() * 60;
break;
case ‚Äòoiseau‚Äô:
case ‚Äòpapillon‚Äô:
x = Math.random() * 85;
y = Math.random() * 66;
break;
default:
x = Math.random() * 85;
y = Math.random() * 75;
}
return { x: x, y: y };
}

function findNonOverlappingPosition(type) {
const maxAttempts = 50;
const minDistance = 10;
for (let attempt = 0; attempt < maxAttempts; attempt++) {
const pos = getPositionForType(type);
let overlapping = false;
for (let p of data) {
const distance = Math.sqrt(Math.pow(pos.x - p.x, 2) + Math.pow(pos.y - p.y, 2));
if (distance < minDistance) {
overlapping = true;
break;
}
}
if (!overlapping) return pos;
}
return getPositionForType(type);
}

form.addEventListener(‚Äúsubmit‚Äù, function(e) {
e.preventDefault();
const f = new FormData(form);
if (!selectedCategory) {
alert(‚ÄúVeuillez s√©lectionner une cat√©gorie‚Äù);
return;
}
const cat = categories[selectedCategory];
const type = getRandomPlantType();
const position = findNonOverlappingPosition(type);
const typeImages = plantTypes[type];
const randomImg = typeImages[Math.floor(Math.random() * typeImages.length)];
const items = {};
cat.items.forEach(function(item) {
items[item.name] = f.get(item.name) || ‚Äò‚Äô;
});
const newPlant = {
id: Date.now(),
categorie: selectedCategory,
categorieNom: cat.nom,
categorieEmoji: cat.emoji,
items: items,
forces: selectedForces,
valeurs: selectedValeurs,
type: type,
img: randomImg,
x: position.x,
y: position.y,
eau: 0,
soleil: 0,
date: new Date().toLocaleDateString(‚Äúfr-FR‚Äù)
};
push(plantsRef, newPlant);
overlay.style.display = ‚Äúnone‚Äù;
form.reset();
backToCategories();
showThankYouMessage();
});

function renderGarden() {
garden.innerHTML = ‚Äú‚Äù;
if (data.length === 0) {
garden.innerHTML = ‚Äú<div class='loading'>üå± Le jardin est vide‚Ä¶ Plante la premi√®re exp√©rience !</div>‚Äù;
return;
}
data.forEach(function(p, i) {
const container = document.createElement(‚Äúdiv‚Äù);
container.className = ‚Äúplant-container‚Äù;
container.style.left = p.x + ‚Äú%‚Äù;
container.style.top = p.y + ‚Äú%‚Äù;
const maxGrowth = (p.type === ‚Äòarbre‚Äô || p.type === ‚Äòarbuste‚Äô) ? 10 : 5;
const growthFactor = Math.min((p.eau || 0) + (p.soleil || 0), maxGrowth);
const maxScale = (p.type === ‚Äòarbre‚Äô || p.type === ‚Äòarbuste‚Äô) ? 2.0 : 1.5;
const scale = 1 + (growthFactor / maxGrowth) * (maxScale - 1);
const baseSize = 90;
const size = baseSize * scale;
const zIndex = i === 0 ? 20 : Math.round((100 - p.y) / 5);
container.style.zIndex = zIndex;
const img = document.createElement(‚Äúimg‚Äù);
img.src = p.img;
img.alt = ‚ÄúPlante ‚Äú + p.type;
img.className = ‚Äúplant ‚Äú + (p.type || ‚Äòfleur‚Äô);
img.style.width = size + ‚Äúpx‚Äù;
img.style.setProperty(‚Äô‚Äìscale‚Äô, scale);
img.onclick = function() { openNotebook(i); };
container.appendChild(img);
if (i === 0 && scale < 1.3) {
const circle = document.createElement(‚Äúdiv‚Äù);
circle.className = ‚Äúhighlight-circle‚Äù;
circle.style.width = (size + 20) + ‚Äúpx‚Äù;
circle.style.height = (size + 20) + ‚Äúpx‚Äù;
circle.style.left = ‚Äú-10px‚Äù;
circle.style.top = ‚Äú-10px‚Äù;
container.appendChild(circle);
}
garden.appendChild(container);
});
}

function openNotebook(index) {
currentPage = index;
notebook.classList.remove(‚Äúopen‚Äù);
setTimeout(function() {
renderNotebook();
notebook.classList.add(‚Äúopen‚Äù);
}, 40);
}

document.getElementById(‚ÄòcloseNotebook‚Äô).addEventListener(‚Äòclick‚Äô, function() {
notebook.classList.remove(‚Äúopen‚Äù);
});

function waterPlant(plantId, type) {
const sessionKey = plantId + ‚Äò_‚Äô + type;
if (sessionWatered[sessionKey]) return;
const plant = data.find(function(p) { return p.firebaseId === plantId; });
if (!plant) return;
if (type === ‚Äòwater‚Äô) {
plant.eau = (plant.eau || 0) + 1;
} else {
plant.soleil = (plant.soleil || 0) + 1;
}
sessionWatered[sessionKey] = true;
const plantRef = ref(database, ‚Äòplants/‚Äô + plantId);
update(plantRef, { eau: plant.eau, soleil: plant.soleil });
renderNotebook();
renderGarden();
}

window.waterPlant = waterPlant;

function renderNotebook() {
if (data.length === 0) {
notebookContent.innerHTML = ‚Äú<p style='text-align:center; padding:40px;'>Aucune exp√©rience plant√©e pour l‚Äôinstant‚Ä¶</p>‚Äù;
return;
}
const p = data[currentPage];
const waterKey = p.firebaseId + ‚Äò_water‚Äô;
const sunKey = p.firebaseId + ‚Äò_sun‚Äô;
const maxGrowth = (p.type === ‚Äòarbre‚Äô || p.type === ‚Äòarbuste‚Äô) ? 200 : 150;
const maxInteractions = maxGrowth === 200 ? 10 : 5;
const currentGrowth = Math.min(100 + (((p.eau || 0) + (p.soleil || 0)) / maxInteractions) * (maxGrowth - 100), maxGrowth);
let itemsHTML = ‚Äò‚Äô;
if (p.items) {
const cat = categories[p.categorie];
if (cat) {
cat.items.forEach(function(item) {
const value = p.items[item.name];
if (value) {
itemsHTML += ‚Äò<div class="notebook-section"><div class="section-label">‚Äô + item.label + ‚Äò</div><div class="section-content">‚Äô + value + ‚Äò</div></div>‚Äô;
}
});
}
}
let forcesHTML = ‚Äò‚Äô;
if (p.forces && p.forces.length > 0) {
forcesHTML = ‚Äò<div class="notebook-section"><div class="section-label">üí™ Forces mobilis√©es</div><div class="section-content">‚Äô + p.forces.join(‚Äô, ‚Äò) + ‚Äò</div></div>‚Äô;
}
let valeursHTML = ‚Äò‚Äô;
if (p.valeurs && p.valeurs.length > 0) {
valeursHTML = ‚Äò<div class="notebook-section"><div class="section-label">‚≠ê Valeurs en jeu</div><div class="section-content">‚Äô + p.valeurs.join(‚Äô, ‚Äô) + ‚Äò</div></div>‚Äô;
}
notebookContent.innerHTML = ‚Äô<div class="notebook-page"><div class="page-header"><div class="page-date">üìÖ ‚Äô + p.date + ‚Äô ‚Ä¢ ‚Äô + (p.categorieEmoji || ‚Äò‚Äô) + ‚Äô ‚Äô + (p.categorieNom || ‚ÄòExp√©rience‚Äô) + ‚Äò</div></div>‚Äô +
itemsHTML + forcesHTML + valeursHTML +
‚Äô<div class="interaction-stats"><div class="stat-item">üíß Eau : ‚Äô + (p.eau || 0) + ‚Äô</div><div class="stat-item">‚òÄÔ∏è Soleil : ‚Äô + (p.soleil || 0) + ‚Äô</div><div class="stat-item">üå± Croissance : ‚Äô + Math.round(currentGrowth) + ‚Äò%</div></div>‚Äô +
‚Äô<div class="water-actions"><button class=‚Äúwater-btn ‚Äô + (sessionWatered[waterKey] ? ‚Äòused‚Äô : ‚Äò‚Äô) + ‚Äò‚Äù onclick=‚ÄúwaterPlant('‚Äô + p.firebaseId + ‚Äò', 'water')‚Äù ‚Äô + (sessionWatered[waterKey] ? ‚Äòdisabled‚Äô : ‚Äò‚Äô) + ‚Äô aria-label=‚ÄúArroser la plante‚Äù>üíß</button>‚Äô +
‚Äô<button class=‚Äúwater-btn ‚Äô + (sessionWatered[sunKey] ? ‚Äòused‚Äô : ‚Äò‚Äô) + ‚Äò‚Äù onclick=‚ÄúwaterPlant('‚Äô + p.firebaseId + ‚Äò', 'sun')‚Äù ‚Äô + (sessionWatered[sunKey] ? ‚Äòdisabled‚Äô : ‚Äò‚Äô) + ‚Äô aria-label=‚ÄúDonner du soleil √† la plante‚Äù>‚òÄÔ∏è</button></div></div>‚Äô;
updatePageNav();
}

function updatePageNav() {
prevBtn.disabled = currentPage === 0;
nextBtn.disabled = currentPage === data.length - 1;
pageInfo.textContent = (currentPage + 1) + ‚Äô / ‚Äô + data.length;
}

prevBtn.addEventListener(‚Äòclick‚Äô, function() {
if (currentPage > 0) {
currentPage‚Äì;
renderNotebook();
}
});

nextBtn.addEventListener(‚Äòclick‚Äô, function() {
if (currentPage < data.length - 1) {
currentPage++;
renderNotebook();
}
});
</script>

</body>
</html>
