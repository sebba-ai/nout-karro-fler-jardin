<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Nout Karro Fler ‚Äî Jardin attentionnel partag√©</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ----------------- AMBIANCE G√âN√âRALE ----------------- */
body {
    margin: 0;
    font-family: "Georgia", serif;
    background: url("assets/bg-paper.jpg") center/cover fixed;
    color: #2f3e34;
    overflow-x: hidden;
}

h1,h2,h3 {
    font-weight: normal;
}

/* ----------------- LOGIN ----------------- */
#login {
    position: fixed;
    inset: 0;
    background: rgba(245,245,240,0.96);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
}

#loginBox {
    background: rgba(255,255,255,0.85);
    padding: 40px;
    border-radius: 20px;
    text-align: center;
    box-shadow: 0 20px 40px rgba(0,0,0,0.15);
}

#loginBox input {
    padding: 14px;
    width: 100%;
    border-radius: 12px;
    border: 1px solid #aaa;
    font-size: 16px;
}

#loginBox button {
    margin-top: 20px;
    padding: 14px 30px;
    border: none;
    border-radius: 30px;
    background: #6fa58c;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

/* ----------------- PAGE PRINCIPALE ----------------- */
#main {
    display: none;
    padding: 40px;
}

#quote {
    text-align: center;
    font-style: italic;
    opacity: 0.8;
    margin-bottom: 30px;
}

/* ----------------- BOUTON AJOUT ----------------- */
#addBtn {
    display: block;
    margin: 30px auto;
    padding: 16px 36px;
    border-radius: 40px;
    border: none;
    background: #8bbf9f;
    color: white;
    font-size: 18px;
    cursor: pointer;
}

/* ----------------- JARDIN ----------------- */
#garden {
    position: relative;
    width: 100%;
    height: 600px;
    border-radius: 30px;
    background: rgba(255,255,255,0.35);
    overflow: hidden;
    box-shadow: inset 0 0 40px rgba(0,0,0,0.08);
}

.plant {
    position: absolute;
    animation: breathe 8s ease-in-out infinite;
    cursor: pointer;
    transition: transform 0.5s ease, filter 0.3s ease;
    transform-origin: bottom center;
}

.plant:hover {
    filter: brightness(1.1) drop-shadow(0 0 15px rgba(139,191,159,0.6));
}

.plant.latest {
    filter: drop-shadow(0 0 20px rgba(255,215,130,0.9));
}

@keyframes breathe {
    0%,100% { transform: scale(var(--scale, 1)); }
    50% { transform: scale(calc(var(--scale, 1) * 1.04)); }
}

/* ----------------- EAU & SOLEIL ----------------- */
.water, .sun {
    position: absolute;
    pointer-events: none;
    animation: fade 2s ease-out forwards;
    font-size: 24px;
}

@keyframes fade {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(-30px); }
}

/* ----------------- FORMULAIRE AJOUT ----------------- */
#overlay {
    position: fixed;
    inset: 0;
    background: rgba(250,250,245,0.96);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 90;
}

form {
    background: white;
    padding: 40px;
    border-radius: 25px;
    width: 420px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.2);
    max-height: 90vh;
    overflow-y: auto;
}

form select, form textarea, form input {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 12px;
    border: 1px solid #ccc;
}

form button {
    margin-top: 20px;
    padding: 14px;
    width: 100%;
    border-radius: 30px;
    border: none;
    background: #6fa58c;
    color: white;
    font-size: 16px;
    cursor: pointer;
}

/* ----------------- CARNET DE JARDINIER ----------------- */
#notebook {
    position: fixed;
    right: -600px;
    top: 0;
    bottom: 0;
    width: 550px;
    background: linear-gradient(to right, #8b7355 0%, #8b7355 20px, #f9f7f1 20px);
    box-shadow: -10px 0 30px rgba(0,0,0,0.3);
    z-index: 95;
    transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
}

#notebook.open {
    right: 0;
}

/* Spirale d√©corative */
#notebook::before {
    content: '';
    position: absolute;
    left: 8px;
    top: 40px;
    bottom: 40px;
    width: 12px;
    background: repeating-linear-gradient(
        to bottom,
        transparent 0px,
        transparent 15px,
        #6b5d4f 15px,
        #6b5d4f 20px,
        transparent 20px,
        transparent 35px
    );
    border-radius: 2px;
}

#notebookContent {
    margin-left: 30px;
    padding: 40px 30px 40px 20px;
    height: 100%;
    overflow-y: auto;
    background: 
        repeating-linear-gradient(
            transparent,
            transparent 31px,
            #e8dcc8 31px,
            #e8dcc8 32px
        ),
        #f9f7f1;
}

#closeNotebook {
    position: absolute;
    right: 20px;
    top: 20px;
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #6fa58c;
    z-index: 1;
    transition: transform 0.2s;
}

#closeNotebook:hover {
    transform: rotate(90deg);
}

.notebook-page {
    margin-bottom: 60px;
    padding-bottom: 30px;
    border-bottom: 2px dashed #d4c5b0;
    line-height: 32px;
}

.notebook-page:last-child {
    border-bottom: none;
}

.page-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding-bottom: 15px;
    border-bottom: 3px solid #6fa58c;
}

.page-date {
    font-size: 14px;
    color: #8b7355;
    font-style: italic;
}

.page-number {
    background: #6fa58c;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 12px;
}

.notebook-section {
    margin: 20px 0;
}

.section-label {
    font-weight: bold;
    color: #6fa58c;
    font-size: 13px;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
}

.section-content {
    color: #2f3e34;
    font-size: 15px;
    padding-left: 10px;
}

.interaction-stats {
    display: flex;
    gap: 15px;
    margin-top: 15px;
    padding: 10px;
    background: rgba(139,191,159,0.1);
    border-radius: 8px;
}

.stat-item {
    display: flex;
    align-items: center;
    gap: 5px;
    font-size: 14px;
}

/* Navigation pages */
#pageNav {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 10px;
    background: rgba(255,255,255,0.9);
    padding: 10px 20px;
    border-radius: 30px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

#pageNav button {
    background: #6fa58c;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    cursor: pointer;
    font-size: 14px;
}

#pageNav button:disabled {
    background: #ccc;
    cursor: not-allowed;
}

#pageInfo {
    display: flex;
    align-items: center;
    padding: 0 10px;
    color: #6fa58c;
    font-weight: bold;
}

/* Loading indicator */
.loading {
    text-align: center;
    padding: 20px;
    color: #6fa58c;
}
</style>

</head>

<body>

<div id="login">
    <div id="loginBox">
        <h2>üå± Nout Karro Fler</h2>
        <p>Entre dans le jardin</p>
        <input id="pwd" type="password" placeholder="mot de passe">
        <button onclick="checkPassword()">Entrer</button>
    </div>
</div>

<div id="main">
    <h1>Le jardin de l'attention</h1>
    <div id="quote"></div>

```
<button id="addBtn" onclick="openForm()">‚ûï Planter une exp√©rience</button>

<div id="garden">
    <div class="loading">üå± Chargement du jardin...</div>
</div>
```

</div>

<div id="overlay">
<form id="form">
  <h3>üåø Planter une exp√©rience</h3>

  <select name="activite" required>
    <option value="">Contexte / activit√©</option>
    <option>Soin / accompagnement</option>
    <option>√âchange / relation</option>
    <option>Cr√©ation / r√©flexion</option>
    <option>Transmission</option>
    <option>Autre</option>
  </select>

  <textarea name="experience"
   placeholder="D√©cris l'exp√©rience v√©cue, simplement‚Ä¶"
   required></textarea>

  <textarea name="ressenti"
   placeholder="Ce que cela a provoqu√©, appris, transform√©‚Ä¶"></textarea>

  <select name="force">
    <option value="">Force mobilis√©e (VIA)</option>

```
<optgroup label="üß† SAGESSE ET CONNAISSANCE">
  <option>Curiosit√©</option>
  <option>Amour de l'apprentissage</option>
  <option>Jugement / Pens√©e critique</option>
  <option>Ing√©niosit√© / Cr√©ativit√©</option>
  <option>Perspective / Sagesse</option>
</optgroup>

<optgroup label="üí™ COURAGE">
  <option>Bravoure</option>
  <option>Pers√©v√©rance</option>
  <option>Int√©grit√© / Honn√™tet√©</option>
  <option>Enthousiasme</option>
</optgroup>

<optgroup label="‚ù§Ô∏è HUMANIT√â">
  <option>Amour</option>
  <option>Gentillesse</option>
  <option>Intelligence sociale / Empathie</option>
</optgroup>

<optgroup label="‚öñÔ∏è JUSTICE">
  <option>√âquit√©</option>
  <option>Leadership</option>
  <option>Travail d'√©quipe / Esprit de citoyennet√©</option>
</optgroup>

<optgroup label="üßò TEMP√âRANCE">
  <option>Pardon / Indulgence</option>
  <option>Humilit√© / Modestie</option>
  <option>Prudence / Pr√©venance</option>
  <option>Autocontr√¥le / R√©gulation de soi</option>
</optgroup>

<optgroup label="‚ú® TRANSCENDANCE">
  <option>Appr√©ciation de la beaut√© et de l'excellence</option>
  <option>Gratitude</option>
  <option>Espoir / Optimisme</option>
  <option>Humour</option>
  <option>Spiritualit√© / Foi</option>
</optgroup>
```

  </select>

<input name="forceLibre"
placeholder="Autre force (si diff√©rente)">

  <select name="valeur">
    <option value="">Valeur en jeu (Schwartz)</option>

```
<optgroup label="üåç OUVERTURE AU CHANGEMENT">
  <option>Autod√©termination-pens√©e</option>
  <option>Autod√©termination-action</option>
  <option>Stimulation</option>
  <option>H√©donisme</option>
</optgroup>

<optgroup label="üéØ CROISSANCE PERSONNELLE">
  <option>R√©alisation</option>
  <option>Pouvoir-dominance</option>
  <option>Pouvoir-ressources</option>
</optgroup>

<optgroup label="üõ°Ô∏è CONSERVATION">
  <option>Image publique</option>
  <option>S√©curit√©-personnel</option>
  <option>Tradition</option>
  <option>Conformit√©-r√®gles</option>
  <option>Conformit√©-interpersonnelle</option>
  <option>Humilit√©</option>
</optgroup>

<optgroup label="üíó D√âPASSEMENT DE SOI">
  <option>Bienveillance-soins</option>
  <option>Bienveillance-fiabilit√©</option>
  <option>Universalisme-pr√©occupation</option>
  <option>Universalisme-nature</option>
  <option>Universalisme-tol√©rance</option>
</optgroup>
```

  </select>

<input name="pourQui"
placeholder="Pour qui cette exp√©rience a compt√© ?">

<button type="submit">üå∏ Planter</button>

</form>
</div>

<!-- CARNET DE JARDINIER -->

<div id="notebook">
    <button id="closeNotebook" onclick="closeNotebook()">‚úï</button>
    <div id="notebookContent"></div>
    <div id="pageNav">
        <button onclick="prevPage()" id="prevBtn">‚Üê Pr√©c√©dent</button>
        <div id="pageInfo"></div>
        <button onclick="nextPage()" id="nextBtn">Suivant ‚Üí</button>
    </div>
</div>

<!-- Firebase SDK -->

<script type="module">
  // Import Firebase (VERSION CORRIG√âE)
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import { getDatabase, ref, push, onValue, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

  // Configuration Firebase (TES VRAIS IDENTIFIANTS)
  const firebaseConfig = {
    apiKey: "AIzaSyADBlPY8lK_52mFTWWHdoEBcPXa4Dk3FVA",
    authDomain: "jardin-3f127.firebaseapp.com",
    databaseURL: "https://jardin-3f127-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "jardin-3f127",
    storageBucket: "jardin-3f127.firebasestorage.app",
    messagingSenderId: "371927426307",
    appId: "1:371927426307:web:dba165b1aaf4b8179e3536"
  };

  // Initialiser Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const plantsRef = ref(database, 'plants');

  // Variables globales
  window.db = database;
  window.plantsRef = plantsRef;

  const PASSWORD = "jardin";

  const quotes = [
      "Ce √† quoi tu pr√™tes attention grandit.",
      "Chaque geste nourrit une racine invisible.",
      "Le vivant se cultive par la pr√©sence.",
      "Un jardin est une m√©moire qui respire."
  ];

  const plantImages = [
      "assets/plants/fleur1.png",
      "assets/plants/fleur2.png",
      "assets/plants/arbuste1.png",
      "assets/plants/arbre1.png",
      "assets/plants/fruit1.png"
  ];

  let data = [];
  let currentPage = 0;

  window.checkPassword = function() {
      if (pwd.value === PASSWORD) {
          login.style.display = "none";
          main.style.display = "block";
          quote.innerText = quotes[Math.floor(Math.random()*quotes.length)];
          loadPlants();
      }
  }

  window.openForm = function() {
      overlay.style.display = "flex";
  }

  // Charger les plantes depuis Firebase
  function loadPlants() {
      onValue(plantsRef, (snapshot) => {
          data = [];
          snapshot.forEach((childSnapshot) => {
              const plant = childSnapshot.val();
              plant.firebaseId = childSnapshot.key;
              data.push(plant);
          });
          
          data.sort((a, b) => b.id - a.id);
          renderGarden();
      });
  }

  // Fonction pour v√©rifier les chevauchements
  function findNonOverlappingPosition(size) {
      const maxAttempts = 100;
      const minDistance = 15;
      
      for (let attempt = 0; attempt < maxAttempts; attempt++) {
          const x = Math.random() * (95 - size);
          const y = Math.random() * (85 - size);
          
          let overlapping = false;
          for (let p of data) {
              const distance = Math.sqrt(
                  Math.pow(x - p.x, 2) + Math.pow(y - p.y, 2)
              );
              
              if (distance < minDistance) {
                  overlapping = true;
                  break;
              }
          }
          
          if (!overlapping) {
              return { x, y };
          }
      }
      
      return { 
          x: Math.random() * 85, 
          y: Math.random() * 75 
      };
  }

  // Soumettre le formulaire
  form.addEventListener("submit", e => {
      e.preventDefault();
      const f = new FormData(form);
      
      const position = findNonOverlappingPosition(10);
      
      const newPlant = {
          id: Date.now(),
          activite: f.get("activite"),
          experience: f.get("experience"),
          ressenti: f.get("ressenti"),
          force: f.get("force") || f.get("forceLibre"),
          valeur: f.get("valeur"),
          pourQui: f.get("pourQui"),
          img: plantImages[Math.floor(Math.random()*plantImages.length)],
          x: position.x,
          y: position.y,
          eau: 0,
          soleil: 0,
          size: 1,
          date: new Date().toLocaleDateString("fr-FR")
      };
      
      push(plantsRef, newPlant);
      
      overlay.style.display = "none";
      form.reset();
  });

  function renderGarden() {
      garden.innerHTML = "";
      
      if (data.length === 0) {
          garden.innerHTML = "<div class='loading'>üå± Le jardin est vide... Plante la premi√®re exp√©rience !</div>";
          return;
      }
      
      data.forEach((p, i) => {
          const img = document.createElement("img");
          img.src = p.img;
          img.className = "plant" + (i === 0 ? " latest" : "");
          
          const scale = 1 + (p.eau + p.soleil) * 0.1;
          const size = Math.min(90 * scale, 150);
          
          img.style.width = size + "px";
          img.style.left = p.x + "%";
          img.style.top = p.y + "%";
          img.style.setProperty('--scale', scale);
          
          img.onclick = () => openNotebook(i);
          
          garden.appendChild(img);
      });
  }

  function react(plantIndex) {
      const p = data[plantIndex];
      const isWater = Math.random() > 0.5;
      
      if (isWater) {
          p.eau++;
          drop("üíß", p.x, p.y);
      } else {
          p.soleil++;
          drop("‚òÄÔ∏è", p.x, p.y);
      }
      
      const plantRef = ref(database, 'plants/' + p.firebaseId);
      update(plantRef, { eau: p.eau, soleil: p.soleil });
      
      renderGarden();

      function drop(symbol, x, y) {
          const s = document.createElement("div");
          s.className = symbol === "üíß" ? "water" : "sun";
          s.innerText = symbol;
          s.style.left = x + "%";
          s.style.top = y + "%";
          garden.appendChild(s);
          setTimeout(() => s.remove(), 2000);
      }
  }

  window.openNotebook = function(index) {
      currentPage = index;
      react(index);
      renderNotebook();
      notebook.classList.add("open");
  }

  window.closeNotebook = function() {
      notebook.classList.remove("open");
  }

  function renderNotebook() {
      if (data.length === 0) {
          notebookContent.innerHTML = "<p style='text-align:center; padding:40px;'>Aucune exp√©rience plant√©e pour l'instant...</p>";
          return;
      }
      
      const p = data[currentPage];
      
      notebookContent.innerHTML = `
          <div class="notebook-page">
              <div class="page-header">
                  <div class="page-date">üìÖ ${p.date}</div>
                  <div class="page-number">Page ${currentPage + 1}/${data.length}</div>
              </div>
              
              <div class="notebook-section">
                  <div class="section-label">üåç Contexte</div>
                  <div class="section-content">${p.activite || "‚Äî"}</div>
              </div>
              
              <div class="notebook-section">
                  <div class="section-label">‚ú® Exp√©rience v√©cue</div>
                  <div class="section-content">${p.experience || "‚Äî"}</div>
              </div>
              
              ${p.ressenti ? `
              <div class="notebook-section">
                  <div class="section-label">üí≠ Ressenti & transformation</div>
                  <div class="section-content">${p.ressenti}</div>
              </div>
              ` : ''}
              
              ${p.force ? `
              <div class="notebook-section">
                  <div class="section-label">üí™ Force mobilis√©e</div>
                  <div class="section-content">${p.force}</div>
              </div>
              ` : ''}
              
              ${p.valeur ? `
              <div class="notebook-section">
                  <div class="section-label">‚≠ê Valeur en jeu</div>
                  <div class="section-content">${p.valeur}</div>
              </div>
              ` : ''}
              
              ${p.pourQui ? `
              <div class="notebook-section">
                  <div class="section-label">üë• Pour qui</div>
                  <div class="section-content">${p.pourQui}</div>
              </div>
              ` : ''}
              
              <div class="interaction-stats">
                  <div class="stat-item">üíß Eau : ${p.eau}</div>
                  <div class="stat-item">‚òÄÔ∏è Soleil : ${p.soleil}</div>
                  <div class="stat-item">üå± Croissance : ${Math.round((1 + (p.eau + p.soleil) * 0.1) * 100)}%</div>
              </div>
          </div>
      `;
      
      updatePageNav();
  }

  function updatePageNav() {
      prevBtn.disabled = currentPage === 0;
      nextBtn.disabled = currentPage === data.length - 1;
      pageInfo.textContent = `${currentPage + 1} / ${data.length}`;
  }

  window.prevPage = function() {
      if (currentPage > 0) {
          currentPage--;
          renderNotebook();
      }
  }

  window.nextPage = function() {
      if (currentPage < data.length - 1) {
          currentPage++;
          renderNotebook();
      }
  }
</script>

</body>
</html>
